<html>
	<head>
	<title>||Project|| Performancetest Summary [${testrundatetime}]</title>
			
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colorschemes@latest/dist/chartjs-plugin-colorschemes.min.js"></script>

	<style type="text/css">
		body {
			font: normal 68% verdana, arial, helvetica;
			color: #000000;
		}

		table tr td,
		table tr th {
			font-size: 68%;
		}

		table tr td.green {
			background-color: lime;
		}

		table tr td.yellow {
			background-color: yellow;
		}

		table tr td.red {
			background-color: red;
			color: white;
		}

		table.config tr th {
			font-weight: bold;
			background: #a6caf0;
			text-align: center;
		}

		table.config tr td {
			white-space: nowrap;
			text-align: left;
			padding-left: 5px;
			padding-right: 10px; //width:100px;
		}

		table.config tr td.header {
			background: #eeeee0; //font-style:italic;
		}
		
		table.config tr td.rightalign {
			text-align: right;
		}

		table.config tr td.name {
			background: #eeeee0;
			min-width:120px;
		}

		table.config tr td.highlight {
			background-color: yellow;
		}

		table.details tr th {
			font-weight: bold;
			background: #a6caf0;
			text-align: left;
			vertical-align: left;
		}
		
		table.details tr th.blank {
			font-weight: bold;
			background-color: white;
			text-align: center;
		}

		table.details tr td {
			background-color: #eeeee0;
			white-space: nowrap;
			text-align: right;
		}

		table.details tr td.blank {
			background-color: white;
			white-space: nowrap;
			text-align: right;
		}
		
		table.details tr td.name {
			font-weight: bold;
			text-align: left;
			min-width: 400px;
		}

		table.details tr td.green {
			background-color: lime;
		}

		table.details tr td.yellow {
			background-color: yellow;
		}

		table.details tr td.red {
			background-color: red;
			color: white;
		}

		h1 {
			margin: 0px 0px 5px;
			font: 165% verdana, arial, helvetica
		}

		h2 {
			margin-top: 1em;
			margin-bottom: 0.5em;
			125% verdana,
			arial,
			helvetica
		}

		h3 {
			margin-bottom: 0.5em;
			115% verdana,
			arial,
			helvetica
		}

		.Failure {
			font-weight: bold;
			color: red;
		}

		/* Rotation */		
		th.rotate {
			height: 170px;
			white-space: nowrap;
		}

		th.rotate > div {
			transform: 
				translate(0px, 55px)
				rotate(270deg);
			width: 40px;
		}
		
		th.rotate > div > span {
			border-bottom: 1px solid #ccc;
			padding: 1px 1px;
		}

	</style>
	
</head>
<body>
	
<table width="100%"><tr>
<td>
	<h1>||Project|| Performancetest Summary [${testrundatetime}]</h1> 
</td>
<td align="right">
<a href="https://github.com/ICTU/performancetest-runner/wiki/Evaluation-of-testresults:-5-steps" target='_blank'>Help on report evaluation</a>
</td>
<td align="right">
<img src="${companylogoreference}" height="30p"/>
</td></tr></table>
	
<hr align="left" width="100%" size="1"/>

<p class="Failure">${messages}</p>

<table><tr valign="top"><td>

<h3>Specification</h3>
<table class="config">
	<tr><td class="name">Comment</td><td id="comment">${label}</td></tr>
<tr><td>&nbsp</td></tr>
	<tr><td class="name">Application version</td><td id="application_version">${appversion}</td></tr>
	<tr><td class="name">Workload</td><td id="workload">${workload}</td></tr>
	<tr><td class="name">Loadgenerator</td><td id="loadgenerator">${loadgeneratortype}</td></tr>
	<tr><td class="name">Start of the test</td><td id="start_of_the_test">${testrundatetime}</td></tr>
	<tr><td class="name">Report generated</td><td id="report_generated">${rptgendatetime}</td></tr>
<tr><td>&nbsp</td></tr>
	<tr><td class="name">Baseline version</td><td id="baseline_version">${baseline.appversion}</td></tr>
	<tr><td class="name">Baseline used</td><td id="baseline_used">${_baselineref}</td></tr>
	<tr><td class="name">Baseline reason</td><td id="baseline_reason">${_baselinereason}</td></tr>
<tr><td>&nbsp</td></tr>
	<tr><td class="name">Max trend items</td><td id="max_trend_items">${maxtrendcount}</td></tr>
</table>

</td><td>

<h3>Thresholds</h3>
<table class="config">
	<tr><td></td><td class="header">OK</td><td class="header">WARNING</td><td class="header">HIGH</tr>
	$[<tr><td class="name">${threshold.pattern:#}</td><td class="green rightalign"></td><td class="yellow rightalign">${threshold.th1:#:0.0}</td><td class="red rightalign">${threshold.th2:#:0.0}</td></tr>]
</table>

</td><td>

<table><tr>
<td valign="bottom">*</td><td>
<h3>History</h3><table class="config">
	<tr><td></td><td class="header">Version</td><td class="header">Duration</td><td class="header">Faults (%)</td></tr>
	$[<tr><td class="name"><a href=${projectname}_${workload:#}_${testrundatetime:#}.html>${testrundatetime:#}</a></td><td>${appversion:#::-}</td><td>${testduration:#::-}</td><td>${faultpercentage:#::-}</td></tr>]
</table>
</td>
</tr></table>

</td><td>

<h3>Legend</h3>
<table class="config">
	<tr><td class="name">'No data' value</td><td></td></tr>
	<tr><td class="name">(st)</td><td>static data, not dynamically retrieved</td></tr>
	<tr><td class="name">Evaluated</td><td>Requirements are evaluated against this value</td></tr>
	<tr><td class="name">Baseline</td><td>Baseline's measurement (evaluated value)</td></tr>
	<tr><td class="name">Current</td><td>This session's measurement (evaluated value)</td></tr>
	<tr><td class="name">Delta %</td><td>
		Difference between current and baseline, in % compared to the baseline<br>
		Shows if current or baseline exceeds a threshold (yellow or red)<br>
		Shows if difference is substantial (>15%)<br>
		Shows Red at performance degradation<br>
		Shows Green at performance improvement</td></tr>
	<tr><td class="name">Summary<br><td>
		Only transactions containing pattern '<2digitnumber>_' are evaluated</td></tr>
	<tr><td class="name">Threshold violations<br><td>
		Num of transactions exceeding 'red' threshold</td></tr>
	<tr><td class="name">Baseline warnings<br><td>
		Num of transactions with 'red' baseline delta% are evaluated</td></tr>
	<tr><td class="name">Trendbreak 'scalability'<br><td>
		Percentage of (max) users at which ramp-up of throughput breaks</td></tr>
	<tr><td class="name">Trendbreak 'stability'<br><td>
		Progress of test at which stability of throughput or errorcount breaks</td></tr>
</table>

</td>
</tr></table>

<hr align="left" width="100%" size="1"/>

<table width="100%">
<tr valign="top">
<td><h3>Summary</h3>
<table class="config">
	<tr><td class="name">Transactions failed (%)</td><td id="transactions_failed">${faultpercentage}</td></tr>
	<tr><td class="name">Threshold violations</td><td id="threshold_violations">${_thresholdviolations:4:0:0}</td></tr>
	<tr><td class="name">Baseline warnings</td><td id="baseline_warnings">${_baselinewarnings:4:0:0}</td></tr>
	<tr><td>&nbsp</td><td></td></tr>
	<tr><td class="name">Trendbreak 'scalability' (%)</td><td id="trendbreak_scalability">${trendbreakrampuppercentage}</td></tr>
	<tr><td class="name">Trendbreak 'stability' (%)</td><td id="trendbreak_stability">${trendbreakstabilitypercentage}</td></tr>
	<tr><td>&nbsp</td><td></td></tr>
	<tr><td class="name">Duration</td><td id="duration">${testduration}</td></tr>
	<tr><td class="name">Virtual users</td><td id="virtual_users">${mergedusers}</td></tr>	
	<tr><td class="name">Success</td><td id="success">${AGGREGATED:0:0:0}</td></tr>	
	<tr><td class="name">Failed</td><td id="failed">${AGGREGATED:5:0:0}</td></tr>	
	<tr><td class="name">Canceled</td><td id="canceled">${AGGREGATED:6:0:0}</td></tr>	
	<tr><td class="name">Min of minima</td><td id="min">${AGGREGATED:1:0.000}</td></tr>	
	<tr><td class="name">Avg of averages</td><td id="avg">${AGGREGATED:2:0.000}</td></tr>	
	<tr><td class="name">Avg of 90 percentiles</td><td id="avg_90_percentile">${AGGREGATED:4:0.000}</td></tr>	
	<tr><td class="name">Max of maxima</td><td id="max">${AGGREGATED:3:0.000}</td></tr>	
	<tr><td class="name">Avg of StdDev</td><td id="avg_stddev">${AGGREGATED:9:0.000}</td></tr>	
</table>
</td>
	<td style="min-width: 600px; min-height: 400px"><canvas id="chart_counters"></canvas></td>
	<td style="min-width: 600px; min-height: 400px"><canvas id="chart_trend"></canvas></td>
</tr></table>

<hr align="left" width="100%" size="1"/>
<h3>Trend last ${maxtrendcount} testruns</h3>
<table width="100%"><tr>
	<td width="25%"><canvas id="chart_trend_stats_1"></canvas></td>
	<td width="25%"><canvas id="chart_trend_stats_2"></canvas></td>
	<td width="25%"><canvas id="chart_trend_stats_3"></canvas></td>
	<td width="25%"><canvas id="chart_trend_stats_4"></canvas></td>
</tr></table>
	
<hr align="left" width="100%" size="1"/>

<h2>Response times (ms)</h2>
<table cellspacing="2" cellpadding="5" border="0" class="details">
	<tr valign="top">
	<th class="blank"/><th class="blank"/><th class="blank"/><th class="blank"/><th class="blank">Evaluated</th><th class="blank"/><th class="blank"/><th class="blank"/><th class="blank"/><th class="blank"/><th class="blank">Baseline</th><th class="blank">Current</th><th class="blank"/>
	</tr>
	
	<tr valign="top">
	<th>Transaction</th><th>Success</th><th>Min</th><th>Avg</th><th>90 perc</th><th>Max</th><th>StDev</th><th>Failed</th><th>Canceled</th><th class="blank"/></th><th>${_baselineref}<br>${baseline.appversion}</th><th>${testrundatetime}<br>${appversion}</th><th>Delta %</th>
	</tr>
	
	||BLOK2||

	<tr valign="top">
	<th>Transaction</th><th>Success</th><th>Min</th><th>Avg</th><th>90 perc</th><th>Max</th><th>StDev</th><th>Failed</th><th>Canceled</th><th class="blank"></th><th>${_baselineref}</th><th>${testrundatetime}</th><th>Delta %</th>
	</tr>
</table>

<h2>Trend (ms)</h2>
<table cellspacing="2" cellpadding="5" border="0" class="details">
	<tr>
	<th>Transaction</th>$[<th class="rotate"><div><span>${testrundatetime:#}<br>${appversion:#}</span></div></th>]
	</tr>
	||BLOK3||
</table>


<hr align="left" width="100%" size="1">

<h3>end of report</h3>

<script>
new Chart(document.getElementById("chart_counters"), {
    type: 'line',
    data: {
      labels: [${measuretimeseries}],
      datasets: [
        {
          label: "Response time",
          data: [${Transaction#Overall_Response_Time#Trans.(busy)_ok[s]}],
		  fill: false,
		  lineTension: 0.1,
		  pointRadius: 0,
		  borderColor: ['blue'],
		  borderWidth: 2,
		  yAxisID: 'Y1'
        },
		{
          label: "Transaction rate",
          data: [${Summary_General---Transactions}],
		  fill: false,
		  lineTension: 0.1,
		  pointRadius: 0,
		  borderColor: ['black'],
		  borderWidth: 2,
		  yAxisID: 'Y2'
        },
		{
          label: "Error rate",
          data: [${Summary_General---Errors}],
		  fill: false,
		  lineTension: 0.1,
		  pointRadius: 0,
		  borderColor: ['red'],
		  borderWidth: 2,
		  yAxisID: 'Y2'
        },
		{
          label: "Active users",
          data: [${Summary_General---Active_users}],
		  fill: false,
		  lineTension: 0.1,
		  pointRadius: 0,
		  borderColor: ['green'],
		  borderWidth: 2,
		  yAxisID: 'Y2'
        }]
    },
    options: {
      legend: { 
		display: true,
		position: 'bottom'
		},
	  tooltips: {
		callbacks: {
			label: function(tooltipItem, data) {
					var unit = "";
					if (data.datasets[tooltipItem.datasetIndex].label == "Response time")
						unit = " s";
					if ((data.datasets[tooltipItem.datasetIndex].label == "Transaction rate") || (data.datasets[tooltipItem.datasetIndex].label == "Error rate"))
						unit = " trs\/10s";
					
					if (data.datasets[tooltipItem.datasetIndex].label == "Active users")
						unit = " users";
                    return data.datasets[tooltipItem.datasetIndex].label + ": " + tooltipItem.yLabel + unit;
                },
			title: function(tooltipItem){
                return 'at '+Math.floor((this._data.labels[tooltipItem[0].index])/60)+' minutes';
            }
        }
	  },
      title: {
        display: true,
        text: 'Counters per 10s interval, x-axis is test progress in minutes'
      },
      scales: {
            yAxes: [{
				id: 'Y1',
				type: 'linear',
				position: 'left',
                ticks: { beginAtZero:true },
				scaleLabel: {
					display: true,
					labelString: 'response time (s)'
					}
			},
			{
				id: 'Y2',
				type: 'linear',
				position: 'right',
                ticks: { beginAtZero:true },
				scaleLabel: {
					display: true,
					labelString: 'value'
					}
			}],
			xAxes: [{
                ticks: {
                    beginAtZero:true,
					minRotation: 90,
					maxRotation: 90,					
					callback: function(dataLabel, index) {
								return dataLabel%300 == 0 ? Math.floor((dataLabel)/60) : '';
					}
                },
				gridLines: { display:false }
            }]
        }
    }
});

			
new Chart(document.getElementById("chart_trend"), {
    type: 'line',
    data: {
      labels: [$['${testrundatetime:#}',]],
      datasets: [
        ||BLOK1||]
    },
    options: {
      legend: { 
		display: false
		},
	  tooltips: {
		callbacks: {
			label: function(tooltipItem, data) {
                    return data.datasets[tooltipItem.datasetIndex].label + ": " + tooltipItem.yLabel + ' s';
                },
			title: function(tooltipItem){
                return 'at testrun '+this._data.labels[tooltipItem[0].index];
				}
        }
	  },
	  	  plugins: {
		colorschemes: { scheme: 'office.Parallax6' }
	  },
      title: {
        display: true,
        text: 'Response times last ${maxtrendcount} testruns'
      },
      scales: {
            yAxes: [{
				id: 'Y1',
				type: 'linear',
				position: 'left',
                ticks: { beginAtZero:true },
				scaleLabel: {
					display: true,
					labelString: 'response time (s)'
					}
			}],
			xAxes: [{
				type: 'category',
				gridLines: { display: true },
				ticks: { display: false	}
            }]
        }
    }
});

new Chart(document.getElementById("chart_trend_stats_1"), {
    type: 'line',
    data: {
      labels: [$['${testrundatetime:#}',]],
      datasets: [
        {			
          label: "Users",
          data: [$[${mergedusers:#::null},]],
		  fill: false,
		  lineTension: 0.1,
		  pointRadius: 2,
		  borderWidth: 2,
		  yAxisID: 'Y1'
},{			
          label: "Faults (%)",
          data: [$[${faultpercentage:#::null},]],
		  fill: false,
		  lineTension: 0.1,
		  pointRadius: 2,
		  borderWidth: 2,
		  yAxisID: 'Y2'
}]
    },
    options: {
      legend: { 
		display: true,
		position: 'bottom'
		},
	  tooltips: {
		callbacks: {
			label: function(tooltipItem, data) {
                    return data.datasets[tooltipItem.datasetIndex].label + ": " + tooltipItem.yLabel;
                },
			title: function(tooltipItem){
                return 'at testrun '+this._data.labels[tooltipItem[0].index];
				}
        }
	  },
	  	  plugins: {
		colorschemes: { scheme: 'office.Parallax6' }
	  },
      title: {
        display: true,
        text: 'General statistics'
      },
      scales: {
            yAxes: [{
				id: 'Y1',
				type: 'linear',
				position: 'left',
                ticks: { beginAtZero:true },
				scaleLabel: {
					display: true,
					labelString: 'number'
					}
},{
				id: 'Y2',
				type: 'linear',
				position: 'right',
                ticks: { beginAtZero:true },
				scaleLabel: {
					display: true,
					labelString: 'percentage'
					}
					
			}],
			xAxes: [{
				type: 'category',
				gridLines: { display: true },
				ticks: { display: false	}
            }]
        }
    }
});

new Chart(document.getElementById("chart_trend_stats_2"), {
    type: 'line',
    data: {
      labels: [$['${testrundatetime:#}',]],
      datasets: [
        {			
          label: "90 Percentiles (s)",
          data: [$[${avgof90percentiles:#::null},]],
		  fill: false,
		  lineTension: 0.1,
		  pointRadius: 2,
		  borderWidth: 2,
		  yAxisID: 'Y1'
},{
          label: "Averages (s)",
          data: [$[${avgofaverages:#::null},]],
		  fill: false,
		  lineTension: 0.1,
		  pointRadius: 2,
		  borderWidth: 2,
		  yAxisID: 'Y1'
}]
    },
    options: {
      legend: { 
		display: true,
		position: 'bottom'
		},
	  tooltips: {
		callbacks: {
			label: function(tooltipItem, data) {
                    return data.datasets[tooltipItem.datasetIndex].label + ": " + tooltipItem.yLabel;
                },
			title: function(tooltipItem){
                return 'at testrun '+this._data.labels[tooltipItem[0].index];
				}
        }
	  },
	  	  plugins: {
		colorschemes: { scheme: 'office.Parallax6' }
	  },
      title: {
        display: true,
        text: 'Response time grand averages'
      },
      scales: {
            yAxes: [{
				id: 'Y1',
				type: 'linear',
				position: 'left',
                ticks: { beginAtZero:true },
				scaleLabel: {
					display: true,
					labelString: 'seconds'
					}
			}],
			xAxes: [{
				type: 'category',
				gridLines: { display: true },
				ticks: { display: false	}
            }]
        }
    }
});

new Chart(document.getElementById("chart_trend_stats_3"), {
    type: 'line',
    data: {
      labels: [$['${testrundatetime:#}',]],
      datasets: [
        {			
          label: "Success",
          data: [$[${transactionstotal:#:0:null},]],
		  fill: false,
		  lineTension: 0.1,
		  pointRadius: 2,
		  borderWidth: 2,
		  yAxisID: 'Y1'
},{
          label: "Failed",
          data: [$[${transactionsfailed:#:0:null},]],
		  fill: false,
		  lineTension: 0.1,
		  pointRadius: 2,
		  borderWidth: 2,
		  yAxisID: 'Y1'
}]
    },
    options: {
      legend: { 
		display: true,
		position: 'bottom'
		},
	  tooltips: {
		callbacks: {
			label: function(tooltipItem, data) {
                    return data.datasets[tooltipItem.datasetIndex].label + ": " + tooltipItem.yLabel;
                },
			title: function(tooltipItem){
                return 'at testrun '+this._data.labels[tooltipItem[0].index];
				}
        }
	  },
	  	  plugins: {
		colorschemes: { scheme: 'office.Parallax6' }
	  },
      title: {
        display: true,
        text: 'Number of transactions'
      },
      scales: {
            yAxes: [{
				id: 'Y1',
				type: 'linear',
				position: 'left',
                ticks: { beginAtZero:true },
				scaleLabel: {
					display: false,
					labelString: 'number'
					}
			}],
			xAxes: [{
				type: 'category',
				gridLines: { display: true },
				ticks: { display: false	}
            }]
        }
    }
});


new Chart(document.getElementById("chart_trend_stats_4"), {
    type: 'line',
    data: {
      labels: [$['${testrundatetime:#}',]],
      datasets: [
        {			
          label: "Scalability (%)",
          data: [$[${trendbreakrampuppercentage:#:0:null},]],
		  fill: false,
		  lineTension: 0.1,
		  pointRadius: 2,
		  borderWidth: 2,
		  yAxisID: 'Y1'
},{
          label: "Stability (%)",
          data: [$[${trendbreakstabilitypercentage:#:0:null},]],
		  fill: false,
		  lineTension: 0.1,
		  pointRadius: 2,
		  borderWidth: 2,
		  yAxisID: 'Y1'
}]
    },
    options: {
      legend: { 
		display: true,
		position: 'bottom'
		},
	  tooltips: {
		callbacks: {
			label: function(tooltipItem, data) {
                    return data.datasets[tooltipItem.datasetIndex].label + ": " + tooltipItem.yLabel;
                },
			title: function(tooltipItem){
                return 'at testrun '+this._data.labels[tooltipItem[0].index];
				}
        }
	  },
	  	  plugins: {
		colorschemes: { scheme: 'office.Parallax6' }
	  },
      title: {
        display: true,
        text: 'Trendbreak'
      },
      scales: {
            yAxes: [{
				id: 'Y1',
				type: 'linear',
				position: 'left',
                ticks: { beginAtZero:true },
				scaleLabel: {
					display: false,
					labelString: 'percentage'
					}
			}],
			xAxes: [{
				type: 'category',
				gridLines: { display: true },
				ticks: { display: false	}
            }]
        }
    }
});
</script>

</body></html>
